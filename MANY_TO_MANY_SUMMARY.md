# –†–µ–∑—é–º–µ: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Many-to-Many —Å—Ç—Ä—É–∫—Ç—É—Ä—É

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `city_nutrition_programs` –¥–ª—è —Å–≤—è–∑–∏ –≥–æ—Ä–æ–¥–æ–≤ –∏ –ø—Ä–æ–≥—Ä–∞–º–º
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `city_id` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `nutrition_programs`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### 2. Backend (API)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `nutritionProgramsController.js`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑—è–º–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Å–∏–≤–∞–º–∏ –≥–æ—Ä–æ–¥–æ–≤

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ ([MIGRATION_GUIDE.md](MIGRATION_GUIDE.md))
- ‚úÖ –°–æ–∑–¥–∞–Ω changelog ([CHANGELOG_MANY_TO_MANY.md](CHANGELOG_MANY_TO_MANY.md))
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã API

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–ª—è –Ω–æ–≤–æ–π –ë–î (—Å –Ω—É–ª—è):

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –ë–î
createdb fitbox

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npm run migrate

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
npm run dev
```

### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è):

```bash
# 1. –°–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø (–≤–∞–∂–Ω–æ!)
pg_dump -U postgres fitbox > backup_before_migration.sql

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
psql -U postgres -d fitbox -f migrations/003_convert_to_many_to_many.sql

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
curl http://localhost:3000/api/programs

# 4. –ï—Å–ª–∏ –≤—Å–µ –æ–∫, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å DROP COLUMN –≤ –º–∏–≥—Ä–∞—Ü–∏–∏
```

## üìä –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø–∏—Ç–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

```json
{
  "id": 1,
  "title": "–ë–∞–ª–∞–Ω—Å",
  "emoji": "üë®‚Äçüíº",
  "data": {
    "calories_from": 1050,
    "calories_to": 1150,
    "proteins": 58,
    "fats": 41,
    "carbohydrates": 113
  },
  "sort": 2,
  "city_ids": [1, 2, 3, 4, 5],
  "city_names": ["–£–ª—å—è–Ω–æ–≤—Å–∫", "–ö–∞–∑–∞–Ω—å", "–°–∞–º–∞—Ä–∞", "–¢–æ–ª—å—è—Ç—Ç–∏", "–î–º–∏—Ç—Ä–æ–≤–≥—Ä–∞–¥"]
}
```

## üîß –ù–æ–≤—ã–µ API endpoints

```bash
# –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –≤ –≥–æ—Ä–æ–¥
POST /api/programs/:programId/cities/:cityId

# –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –∏–∑ –≥–æ—Ä–æ–¥–∞
DELETE /api/programs/:programId/cities/:cityId
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤:
```bash
curl -X POST http://localhost:3000/api/programs \
  -H "Content-Type: application/json" \
  -d '{
    "title": "–î–µ—Ç–æ–∫—Å",
    "emoji": "ü•¨",
    "data": {
      "calories_from": 800,
      "calories_to": 1000,
      "proteins": 60,
      "fats": 30,
      "carbohydrates": 80
    },
    "city_ids": [1, 2, 3, 4, 5],
    "sort": 7
  }'
```

### –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≥–æ—Ä–æ–¥–æ–≤:
```bash
curl -X POST http://localhost:3000/api/programs \
  -H "Content-Type: application/json" \
  -d '{
    "title": "–ü—Ä–µ–º–∏—É–º",
    "emoji": "‚≠ê",
    "data": {...},
    "city_ids": [1, 2],
    "sort": 8
  }'
```

### –î–æ–±–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –≤ –Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥:
```bash
curl -X POST http://localhost:3000/api/programs/1/cities/5
```

### –£–±—Ä–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –∏–∑ –≥–æ—Ä–æ–¥–∞:
```bash
curl -X DELETE http://localhost:3000/api/programs/3/cities/4
```

### –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞:
```bash
curl "http://localhost:3000/api/programs?city_id=1"
```

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

1. **–ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** - –ø—Ä–æ–≥—Ä–∞–º–º–∞ "–ë–∞–ª–∞–Ω—Å" —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –æ–¥–Ω–æ–º —ç–∫–∑–µ–º–ø–ª—è—Ä–µ
2. **–õ–µ–≥—á–µ —É–ø—Ä–∞–≤–ª—è—Ç—å** - –∏–∑–º–µ–Ω–∏–ª–∏ –æ–¥–∏–Ω —Ä–∞–∑ ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ–∑–¥–µ
3. **–ì–∏–±–∫–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
4. **–ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î** - –º–µ–Ω—å—à–µ —Å—Ç—Ä–æ–∫, –±—ã—Å—Ç—Ä–µ–µ –∑–∞–ø—Ä–æ—Å—ã
5. **–ü—Ä–æ—â–µ –¥–æ–±–∞–≤–ª—è—Ç—å –≥–æ—Ä–æ–¥–∞** - –Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥ ‚Üí –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –æ–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥:

**–ë—ã–ª–æ:**
```javascript
program.city_id      // —á–∏—Å–ª–æ
program.city_name    // —Å—Ç—Ä–æ–∫–∞
```

**–°—Ç–∞–ª–æ:**
```javascript
program.city_ids     // –º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª [1, 2, 3]
program.city_names   // –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ ["–ú–æ—Å–∫–≤–∞", "–ö–∞–∑–∞–Ω—å", ...]
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –æ–±–Ω–æ–≤–ª–µ–Ω–∞
2. ‚úÖ API –æ–±–Ω–æ–≤–ª–µ–Ω
3. ‚è≥ **TODO: –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥** (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. ‚è≥ **TODO: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ endpoints**
5. ‚è≥ **TODO: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞**

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [MIGRATION_GUIDE.md](MIGRATION_GUIDE.md) - –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- [CHANGELOG_MANY_TO_MANY.md](CHANGELOG_MANY_TO_MANY.md) - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [API_EXAMPLES.md](API_EXAMPLES.md) - –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

---

–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è. üéâ
